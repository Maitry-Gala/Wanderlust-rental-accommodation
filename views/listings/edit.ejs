<% layout("layouts/boilerplate") %>
<div class="row mt-3">
  <div class="col-8 offset-2">
<h3>Edit your Listing</h3>
    <form method="POST" action="/listings/<%= listing._id %>?_method=PUT" novalidate class="needs-validation" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <input name="listing[title]" value="<%= listing.title %>" type="text" class="form-control"  required/>
        <div class="valid-feedback">Title looks good!</div>
      </div>  
      
      <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea name="listing[description]" class="form-control "  required>
      <%= listing.description %></textarea>
       <div class="valid-feedback">Please enter a short description</div>
      </div>
      
      <div class="mb-3">
          Original Listing Image <br>
          <img src="<%= originalImageUrl %>">
      </div>
      
      <div class="mb-3">
        <label for="image" class="form-label">Upload New Listing Image</label>
        <input name="listing[image]" type="file" class="form-control" accept="image/*" id="editImageInput">
        <div class="form-text text-muted">Maximum file size: 1MB. Supported formats: PNG, JPG, JPEG. Leave empty to keep current image.</div>
        <div id="editFileSizeError" class="text-danger mt-2" style="display: none;"></div>
      </div>


      <div>
        <label for="category" class="form-label">Choose Category</label>
        <div class="category-choose"></div>
        <div class="row">
        <div class="col-md-6">
          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="trending" name="listing[category]"
              value="Trending" required <%= listing.category === 'Trending' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="trending">
              <i class="fa-solid fa-fire me-2"></i> Trending
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="rooms" name="listing[category]"
              value="Rooms" required <%= listing.category === 'Rooms' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="rooms">
              <i class="fa-solid fa-bed me-2"></i> Rooms
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="iconic-cities" name="listing[category]"
              value="Iconic-Cities" required <%= listing.category === 'Iconic-Cities' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="iconic-cities">
              <i class="fa-solid fa-mountain-city me-2"></i> Iconic Cities
            </label>
          </div>
          
          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="Amazing-Pools" name="listing[category]"
              value="Amazing-Pools" required <%= listing.category === 'Amazing-Pools' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="Amazing-Pools">
              <i class="fa-solid fa-person-swimming me-2"></i> Amazing Pools
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="castles" name="listing[category]"
              value="Castles" required <%= listing.category === 'Castles' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="castles">
              <i class="fa-solid fa-fort-awesome me-2"></i> Castles
            </label>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="camping" name="listing[category]"
              value="Camping" required <%= listing.category === 'Camping' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="camping">
              <i class="fa-solid fa-campground me-2"></i> Camping
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="farm" name="listing[category]"
              value="Farm" required <%= listing.category === 'Farm' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="farm">
              <i class="fa-solid fa-cow me-2"></i> Farms
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="arctic" name="listing[category]"
              value="Arctic" required <%= listing.category === 'Arctic' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="arctic">
              <i class="fa-solid fa-snowflake me-2"></i> Arctic
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="domes" name="listing[category]"
              value="Domes" required <%= listing.category === 'Domes' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="domes">
              <i class="fa-solid fa-igloo me-2"></i> Domes
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="boat" name="listing[category]"
              value="Boat" required <%= listing.category === 'Boat' ? 'checked' : '' %>>
            <label class="form-check-label d-flex align-items-center" for="boat">
              <i class="fa-solid fa-sailboat me-2"></i> Boats
            </label>
          </div>
        </div>
      </div>
      <div class="invalid-feedback">Choose Category</div>
    </div>
      

      <div class="row">
      <div class="mb-3 col-md-3">
      <label for="price" class="form-label">Price</label>
      <input name="listing[price]" value="<%= listing.price %>" type="number"class="form-control" required/>
       <div class="valid-feedback">Price should be valid</div>
      </div>

      <div class="mb-3 col-md-3">
      <label for="country" class="form-label">Country</label>
      <input
        name="listing[country]"
        value="<%= listing.country %>"
        type="text"
        class="form-control"
        required
      />
       <div class="valid-feedback">Country name should be valid</div>
      </div>
      </div>


      <div class="mb-3">
      <label for="location" class="form-label">Location</label>  
      <input
        name="listing[location]"
        value="<%= listing.location %>"
        type="text"
        class="form-control"
      /> <div class="valid-feedback">Location should be valid</div>
      </div>

      <button class="btn-dark edit-btn mt-2">Edit</button>
    </form>
  </div>
</div>
    
<script>
document.getElementById('editImageInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const errorDiv = document.getElementById('editFileSizeError');
    const maxSize = 1 * 1024 * 1024; // 1MB in bytes
    
    if (file) {
        // Check file size
        if (file.size > maxSize) {
            const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);
            errorDiv.style.display = 'block';
            errorDiv.textContent = `File size (${fileSizeMB}MB) exceeds the 1MB limit. Please choose a smaller image.`;
            e.target.value = ''; // Clear the input
        } else {
            errorDiv.style.display = 'none';
        }
    }
});
</script>